{"version":3,"file":"NavigationProgress.js","sources":["../src/NavigationProgress.tsx"],"sourcesContent":["import {\n  OptionalPortal,\n  Progress,\n  useMantineTheme,\n  getDefaultZIndex,\n  MantineColor,\n} from '@mantine/core';\nimport { useDidUpdate, useInterval, useReducedMotion } from '@mantine/hooks';\nimport React, { useRef, useState } from 'react';\nimport { useNavigationProgressEvents } from './events';\n\nexport interface NavigationProgressProps {\n  /** The default progress */\n  initialProgress?: number;\n\n  /** Key of theme.colors of any other valid CSS color */\n  color?: MantineColor;\n\n  /** The height of the progressbar in px */\n  size?: number;\n\n  /** Called when the progressbar reaches 100% */\n  onFinish?(): void;\n\n  /** Determines whether progress should be automatically reset when 100% is reached */\n  autoReset?: boolean;\n\n  /** Step interval in ms */\n  stepInterval?: number;\n\n  /** Transition duration in ms */\n  transitionDuration?: number;\n\n  /** Number of ms that should elapse before progressbar is hidden after reaching 100% */\n  exitTimeout?: number;\n\n  /** Exit transition duration in ms */\n  exitTransitionDuration?: number;\n\n  /** Determines whether progressbar should be rendered within Portal, defaults to true */\n  withinPortal?: boolean;\n\n  /** Progressbar z-index */\n  zIndex?: React.CSSProperties['zIndex'];\n\n  /** aria-label for `Progress`*/\n  progressLabel?: string;\n}\n\nexport function NavigationProgress({\n  initialProgress = 0,\n  color,\n  size = 3,\n  stepInterval = 500,\n  transitionDuration = 300,\n  exitTimeout = 500,\n  exitTransitionDuration = 400,\n  onFinish,\n  autoReset = false,\n  withinPortal = true,\n  zIndex = getDefaultZIndex('max'),\n  progressLabel,\n}: NavigationProgressProps) {\n  const theme = useMantineTheme();\n  const shouldReduceMotion = useReducedMotion();\n  const reducedMotion = theme.respectReducedMotion ? shouldReduceMotion : false;\n  const [_progress, setProgress] = useState(initialProgress);\n  const [mounted, setMounted] = useState(true);\n  const [unmountProgress, setUnmountProgress] = useState(false);\n  const resetRef = useRef<number>();\n  const unmountRef = useRef<number>();\n\n  const interval = useInterval(() => {\n    setProgress((amount) => {\n      let next = 0;\n      if (amount >= 0 && amount <= 20) {\n        next = 10;\n      } else if (amount >= 20 && amount <= 50) {\n        next = 4;\n      } else if (amount >= 50 && amount <= 80) {\n        next = 2;\n      } else if (amount >= 80 && amount <= 99) {\n        next = 0.5;\n      }\n\n      return amount + next;\n    });\n  }, stepInterval);\n\n  const set = (value: React.SetStateAction<number>) => setProgress(value);\n  const increment = (value: number) => setProgress((c) => Math.min(c + value, 100));\n  const decrement = (value: number) => setProgress((c) => Math.max(c - value, 0));\n  const start = () => {\n    interval.stop();\n    interval.start();\n  };\n  const stop = () => interval.stop();\n  const reset = () => {\n    setUnmountProgress(true);\n    stop();\n    setProgress(0);\n    window.setTimeout(() => setUnmountProgress(false), 0);\n  };\n  const complete = () => setProgress(100);\n\n  const cancelUnmount = () => {\n    if (unmountRef.current) {\n      window.clearTimeout(unmountRef.current);\n      unmountRef.current = null;\n    }\n    if (resetRef.current) {\n      window.clearTimeout(resetRef.current);\n      resetRef.current = null;\n    }\n\n    setMounted(true);\n  };\n\n  useDidUpdate(() => {\n    if (_progress >= 100) {\n      stop();\n      onFinish?.();\n\n      unmountRef.current = window.setTimeout(() => {\n        unmountRef.current = null;\n        setMounted(false);\n\n        if (autoReset) {\n          resetRef.current = window.setTimeout(\n            () => {\n              resetRef.current = null;\n              reset();\n            },\n            reducedMotion ? 0 : exitTransitionDuration\n          );\n        }\n      }, exitTimeout);\n    } else if (!mounted) {\n      cancelUnmount();\n    }\n  }, [_progress]);\n\n  useNavigationProgressEvents({ start, stop, set, increment, decrement, reset, complete });\n\n  return (\n    <OptionalPortal withinPortal={withinPortal}>\n      {!unmountProgress && (\n        <Progress\n          radius={0}\n          value={_progress}\n          size={size}\n          color={color}\n          styles={{\n            root: {\n              position: 'fixed',\n              top: 0,\n              left: 0,\n              right: 0,\n              zIndex,\n              backgroundColor: 'transparent',\n              transitionProperty: 'opacity',\n              transitionTimingFunction: theme.transitionTimingFunction,\n              transitionDuration: `${\n                reducedMotion || _progress !== 100 ? 0 : exitTransitionDuration\n              }ms`,\n              opacity: mounted ? 1 : 0,\n            },\n            bar: {\n              position: 'relative',\n              transitionProperty: 'width',\n              transitionTimingFunction: theme.transitionTimingFunction,\n              transitionDuration: `${reducedMotion || !mounted ? 0 : transitionDuration}ms`,\n            },\n          }}\n          aria-label={progressLabel}\n        />\n      )}\n    </OptionalPortal>\n  );\n}\n"],"names":[],"mappings":"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"}